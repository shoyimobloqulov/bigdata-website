name: CI/CD to Reg.ru Server

on:
  push:
    branches:
      - main
jobs:
  build:
    name: Build va Test
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Npm ni yangilash
        run: npm install

      - name: Loyihani build qilish
        run: npm run build
  deploy:
    name: Deploy to Reg.ru Server
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main'
    steps:
    - name: ðŸšš Get latest code
      uses: actions/checkout@v4

    - name: ðŸ“‚ Sync files
      uses: SamKirkland/FTP-Deploy-Action@v4.3.5
      with:
        server: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        password: ${{ secrets.PASSWORD }}
        local-dir: "./"
        port: ${{ secrets.TARGET }}
        strip_components: 1
        timeout: 30s
        command_timeout: 10m
        use_insecure_cipher: false
        rm: false
        debug: false
        overwrite: false
        tar_dereference: false
        tar_exec: tar
        proxy_port: 22
        proxy_timeout: 30s
        proxy_use_insecure_cipher: false
